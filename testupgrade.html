<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subscription Test</title>
</head>
<body>
    <!-- Button for Subscription Plan A -->
    <button id="subscribePlanA">Subscribe to Plan A</button>

    <!-- Button for Subscription Plan B -->
    <button id="subscribePlanB">Subscribe to Plan B</button>

    <script 
        id="fsc-api"
        src="https://sbl.onfastspring.com/sbl/0.9.2/fastspring-builder.min.js"
        type="text/javascript"
        data-storefront="languizy.test.onfastspring.com/popup-languizys">
    </script>

    <script type="text/javascript">
        // Predefined email address
        const userEmail = "user@example.com"; // Replace this with the actual user's email.

        document.getElementById("subscribePlanA").addEventListener("click", function () {
            fastspring.builder.checkout({
                products: [
                    {
                        path: "monthly-pro", // Replace with the correct product path from your FastSpring dashboard
                    },
                ],
                customer: {
                    email: userEmail, // Pre-fill the email field
                },
                onPopupClosed: onPopupClosed
            });
        });

        document.getElementById("subscribePlanB").addEventListener("click", function () {
            fastspring.builder.checkout({
                products: [
                    {
                        path: "yearly-pro", // Replace with the correct product path from your FastSpring dashboard
                    },
                ],
                customer: {
                    email: userEmail, // Pre-fill the email field
                },
                onPopupClosed: onPopupClosed
            });
        });

        function onPopupClosed(orderReference) {
            if (orderReference) {
                console.log("Order completed:", orderReference);

                // Notify your backend about the successful payment
                fetch("/api/fastspring-webhook", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ orderReference }),
                })
                .then((response) => response.json())
                .then((data) => {
                    console.log("Database updated successfully:", data);
                    // Redirect user to a success page
                    window.location.href = "/success.html";
                })
                .catch((error) => {
                    console.error("Error updating database:", error);
                });
            } else {
                console.log("Checkout popup closed without purchase.");
                // Redirect user to a failure page or show a message
                window.location.href = "/failure.html";
            }
        }
    </script>
</body>
</html>
